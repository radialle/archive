var Ethereal=function(){};Ethereal.prototype.setTime=function(moment){this.time=moment};Ethereal.prototype.getTime=function(){return this.time};Ethereal.prototype.generateTime=function(){var now=new moment;var maxYear=now.get("year");var minYear=maxYear-90;var year=EtherealMath.generateInt(minYear,maxYear);var month=EtherealMath.generateInt(0,11);now.year(year).month(month).subtract(EtherealMath.generateInt(0,31),"days").subtract(EtherealMath.generateInt(0,24),"hours").subtract(EtherealMath.generateInt(0,60),"minutes");this.setTime(now);return now};Ethereal.prototype.setLocation=function(location){this.location=location};Ethereal.prototype.getLocation=function(){return this.location};Ethereal.prototype.generateLocation=function(){var location=new EtherealLocation;location.setDecimalLatitude(EtherealMath.generateFloat(-90,90));location.setDecimalLongitude(EtherealMath.generateFloat(-180,180));this.setLocation(location);return location};Ethereal.prototype.setSignCollection=function(collection){this.signCollection=collection};Ethereal.prototype.getSignCollection=function(){return this.signCollection};Ethereal.prototype.setPointerCollection=function(collection){this.pointerCollection=collection};Ethereal.prototype.getPointerCollection=function(){return this.pointerCollection};Ethereal.prototype.generate=function(){var time=this.getTime();var asc=this.getAscendant(time);var pointerPositions=this.getPointerPositions(time,asc.degrees);return{ascendant:asc,pointers:pointerPositions}};Ethereal.prototype.getAmanDay=function(time){var zero=new moment({date:22,month:10,year:1997,hour:6});var ad=moment.duration(time.diff(zero)).asDays();return ad};Ethereal.prototype.getSignLimits=function(){var signCollection=this.getSignCollection();var collectionLen=signCollection.getLength();var size=360/collectionLen;var limits=[];for(var i=0;i<=collectionLen;i++)limits.push(i*size);return limits};Ethereal.prototype.getUpdatedSignLimits=function(ascendant){var updatedLimits=this.getSignLimits();for(var i in updatedLimits){updatedLimits[i]+=ascendant;if(updatedLimits[i]>360){updatedLimits[i]-=360}}return updatedLimits};Ethereal.prototype.getPointerPositionSign=function(position,limits){var signCollection=this.getSignCollection();var collectionLen=signCollection.getLength();var fl;var sl;for(var i=0;i<collectionLen;i++){fl=limits[i];sl=limits[i+1];if(sl<fl){if(position>fl&&position<360||position>0&&position<sl||position==0||position==360)return signCollection.get(i)}if(position>fl&&position<sl){return signCollection.get(i)}}};Ethereal.prototype.getPointerPositions=function(time,ascendant){var signCollection=this.getSignCollection();var julianDay=this.getAmanDay(time);var pointers=this.getPointerCollection().getAll();var position;var ret={};for(var i in pointers){position=pointers[i].transitFunction.f(julianDay);ret[pointers[i].getName()]={degrees:position,sign:this.getPointerPositionSign(position,this.getUpdatedSignLimits(ascendant))}}return ret};Ethereal.prototype.getAscendant=function(time){var speed=0;var iv=Math.PI/2;var x=this.getAmanDay(time);var eq;if(speed==0){eq=x+iv}else if(speed<0){eq=x/-speed+iv}else{eq=x*speed+iv}var a=Math.sin(eq+this.getLocation().getDecimalLatitude());var b=Math.cos(eq+this.getLocation().getDecimalLongitude());var r=Math.atan(a/b)*2+Math.PI;var degrees=EtherealMath.radiansToDegrees(r);return{degrees:degrees,sign:this.getPointerPositionSign(degrees,this.getSignLimits())}};var EtherealLocation=function(lat,lon){this.setDecimalLatitude(lat);this.setDecimalLongitude(lon)};EtherealLocation.prototype.setLatitude=function(deg,min,sec){this.setDecimalLatitude(this.DMSToDecimal(deg,min,sec))};EtherealLocation.prototype.setLongitude=function(deg,min,sec){this.setDecimalLongitude(this.DMSToDecimal(deg,min,sec))};EtherealLocation.prototype.setDecimalLatitude=function(latitude){this.latitude=latitude};EtherealLocation.prototype.setDecimalLongitude=function(longitude){this.longitude=longitude};EtherealLocation.prototype.DMSToDecimal=function(deg,min,sec){return deg+min/60+sec/3600};EtherealLocation.prototype.decimalToDMS=function(dec){var deg=Math.floor(dec);var min=Math.floor((dec-deg)*60);var sec=Math.round((dec-deg-min/60)*3600);return[deg,min,sec]};EtherealLocation.prototype.getLatitude=function(){return this.decimalToDMS(this.getDecimalLatitude())};EtherealLocation.prototype.getLongitude=function(){return this.decimalToDMS(this.getDecimalLongitude())};EtherealLocation.prototype.getDecimalLatitude=function(){return this.latitude};EtherealLocation.prototype.getDecimalLongitude=function(){return this.longitude};var EtherealMath={degreesToRadians:function(deg){return deg*(Math.PI/180)},radiansToDegrees:function(rad){return rad*(180/Math.PI)},generateFloat:function(min,max){var num=Math.random()*(max-min)+min;return num},generateInt:function(min,max){var num=this.generateFloat(min,max);num=Math.round(num);return num}};var EtherealPointerTransitFunctionParams=function(){};EtherealPointerTransitFunctionParams.prototype.speed=0;EtherealPointerTransitFunctionParams.prototype.iv=Math.PI/2;var EtherealPointerTransitFunction=function(){this.p=new EtherealPointerTransitFunctionParams};EtherealPointerTransitFunction.prototype.f=function(x){var speed=this.p.speed;var iv=this.p.iv;var eq;x=x+Math.PI/2;if(speed==0){eq=x+iv}else if(speed<0){eq=x/-speed+iv}else{eq=x*speed+iv}var a=Math.sin(eq);var b=Math.cos(eq);var r=Math.atan(a/b)*2+Math.PI;return Math.round(EtherealMath.radiansToDegrees(r))};var EtherealPointer=function(name){this.transitFunction=new EtherealPointerTransitFunction;this.setName(name)};EtherealPointer.prototype.setDefaultTransitFunctionParameters=function(name,val){this.transitFunction.p[name]=val};EtherealPointer.prototype.setTransitFunction=function(f){this.transitFunction.f=f};EtherealPointer.prototype.setName=function(name){this.name=name};EtherealPointer.prototype.getName=function(){return this.name};var EtherealPointerCollection=function(pointer){if(Object.prototype.toString.call(pointer)=="[object Array]"){for(var i in pointer){this.add(pointer[i])}}else{this.add(pointer)}};EtherealPointerCollection.prototype.pointers=[];EtherealPointerCollection.prototype.getAll=function(){return this.pointers};EtherealPointerCollection.prototype.getLength=function(){return this.getAll().length};EtherealPointerCollection.prototype.get=function(i){return this.getAll()[i]};EtherealPointerCollection.prototype.getByName=function(name){var pointers=this.getAll();for(var i in pointers){if(pointers[i].getName()==name){return pointers[i]}}return undefined};EtherealPointerCollection.prototype.add=function(pointer){this.pointers.push(pointer)};var EtherealSign=function(name){this.setName(name)};EtherealSign.prototype.setName=function(name){this.name=name};EtherealSign.prototype.getName=function(){return this.name};var EtherealSignCollection=function(){this.signs=new Array};EtherealSignCollection.prototype.getAll=function(){return this.signs};EtherealSignCollection.prototype.getLength=function(){return this.getAll().length};EtherealSignCollection.prototype.get=function(i){return this.getAll()[i]};EtherealSignCollection.prototype.getByName=function(name){var signs=this.getAll();for(var i in signs){if(signs[i].getName()==name){return signs[i]}}return undefined};EtherealSignCollection.prototype.add=function(sign){this.signs.push(sign)};EtherealSignCollection.prototype.createDefaultCollection=function(){var names=["Crystal Orange","Citrus Yellow","Bright Yellow","Emerald Green","Glazed Green","Moss Green","Sapphire Blue","Orchid Purple","Amethyst Violet","Jasmine Pink","Sparkling Orange","Citrus Orange"];var sign;for(var i in names){sign=new EtherealSign;sign.setName(names[i]);this.add(sign)}};